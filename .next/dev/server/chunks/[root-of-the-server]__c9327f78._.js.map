{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/avbha/OneDrive/Desktop/projects/educify/lib/auth.ts"],"sourcesContent":["import jwt, { type Secret } from \"jsonwebtoken\";\nimport { cookies } from \"next/headers\";\n\nif (!process.env.JWT_SECRET) {\n  throw new Error(\" JWT_SECRET is missing from environment variables\");\n}\n\nconst JWT_SECRET: Secret = process.env.JWT_SECRET;\nconst JWT_EXPIRES_IN: string = process.env.JWT_EXPIRES_IN || \"7d\";\n\nexport interface TokenPayload {\n  userId: string;\n  email: string;\n  iat?: number;\n  exp?: number;\n}\n\nexport function signToken(payload: TokenPayload): string {\n  return jwt.sign(payload, JWT_SECRET, {\n    expiresIn: JWT_EXPIRES_IN,\n  });\n}\n\nexport function verifyToken(token: string): TokenPayload | null {\n  try {\n    const decoded = jwt.verify(token, JWT_SECRET) as TokenPayload;\n    return decoded;\n  } catch (error) {\n    console.error(\"JWT Verify Failed:\", error);\n    return null;\n  }\n}\n\nexport async function setAuthCookie(token: string) {\n  const cookieStore = await cookies();\n  cookieStore.set(\"auth-token\", token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === \"production\",\n    sameSite: \"lax\",\n    maxAge: 7 * 24 * 60 * 60,\n    path: \"/\",\n  });\n}\n\nexport async function clearAuthCookie() {\n  const cookieStore = await cookies();\n  cookieStore.delete(\"auth-token\");\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,UAAU,EAAE;IAC3B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,aAAqB,QAAQ,GAAG,CAAC,UAAU;AACjD,MAAM,iBAAyB,QAAQ,GAAG,CAAC,cAAc,IAAI;AAStD,SAAS,UAAU,OAAqB;IAC7C,OAAO,8LAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QACnC,WAAW;IACb;AACF;AAEO,SAAS,YAAY,KAAa;IACvC,IAAI;QACF,MAAM,UAAU,8LAAG,CAAC,MAAM,CAAC,OAAO;QAClC,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO;IACT;AACF;AAEO,eAAe,cAAc,KAAa;IAC/C,MAAM,cAAc,MAAM,IAAA,wLAAO;IACjC,YAAY,GAAG,CAAC,cAAc,OAAO;QACnC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,QAAQ,IAAI,KAAK,KAAK;QACtB,MAAM;IACR;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,wLAAO;IACjC,YAAY,MAAM,CAAC;AACrB"}},
    {"offset": {"line": 121, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/avbha/OneDrive/Desktop/projects/educify/middleware.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { verifyToken } from \"@/lib/auth\";\n\n// Public UI routes + API routes\nconst PUBLIC_ROUTES = [\n  \"/auth/login\",\n  \"/auth/signup\",\n  \"/auth/google\",\n  \"/auth/google/callback\",\n\n  \"/api/auth/login\",\n  \"/api/auth/signup\",\n  \"/api/auth/google\",\n  \"/api/auth/google/callback\",\n\n  \"/api/search/courses\",\n  \"/api/recommendations\",\n];\n\nexport function middleware(request: NextRequest) {\n  const { pathname } = request.nextUrl;\n\n  console.log(\" Middleware Hit:\", pathname);\n\n  const isPublicRoute = PUBLIC_ROUTES.some((route) =>\n    pathname.startsWith(route)\n  );\n\n  // Allow explicitly public routes first\n  if (isPublicRoute) {\n    console.log(\"Public route → allowing:\", pathname);\n    return NextResponse.next();\n  }\n\n  // Treat course listing (GET /api/courses) as public, but protect other /api/courses routes\n  if (pathname.startsWith(\"/api/courses\")) {\n    if (request.method === \"GET\") {\n      console.log(\"Public GET /api/courses route → allowing:\", pathname);\n      return NextResponse.next();\n    }\n    // For non-GET (POST/PUT/DELETE) require auth and header injection\n  }\n\n  const tokenCookie = request.cookies.get(\"auth-token\");\n  console.log(\" Cookie object:\", tokenCookie);\n\n  const token = tokenCookie?.value;\n  console.log(\" Extracted token:\", token);\n\n  if (!token) {\n    console.log(\" No token — redirecting to login\");\n\n    if (pathname.startsWith(\"/api/\")) {\n      return NextResponse.json(\n        { success: false, error: \"Unauthorized\" },\n        { status: 401 }\n      );\n    }\n\n    return NextResponse.redirect(new URL(\"/auth/login\", request.url));\n  }\n\n  const decoded = verifyToken(token);\n  console.log(\" Token decoded:\", decoded);\n\n  if (!decoded) {\n    console.log(\" Invalid token — redirecting to login\");\n\n    if (pathname.startsWith(\"/api/\")) {\n      return NextResponse.json(\n        { success: false, error: \"Invalid token\" },\n        { status: 401 }\n      );\n    }\n\n    return NextResponse.redirect(new URL(\"/auth/login\", request.url));\n  }\n\n  console.log(\" Token valid. User:\", decoded.email);\n\n  const requestHeaders = new Headers(request.headers);\n  requestHeaders.set(\"x-user-id\", decoded.userId);\n  requestHeaders.set(\"x-user-email\", decoded.email);\n\n  return NextResponse.next({\n    request: { headers: requestHeaders },\n  });\n}\n\nexport const config = {\n  matcher: [\"/((?!_next/static|_next/image|favicon.ico|public).*)\"],\n  runtime: \"nodejs\",\n};\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA,gCAAgC;AAChC,MAAM,gBAAgB;IACpB;IACA;IACA;IACA;IAEA;IACA;IACA;IACA;IAEA;IACA;CACD;AAEM,SAAS,WAAW,OAAoB;IAC7C,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,QAAQ,GAAG,CAAC,oBAAoB;IAEhC,MAAM,gBAAgB,cAAc,IAAI,CAAC,CAAC,QACxC,SAAS,UAAU,CAAC;IAGtB,uCAAuC;IACvC,IAAI,eAAe;QACjB,QAAQ,GAAG,CAAC,4BAA4B;QACxC,OAAO,4LAAY,CAAC,IAAI;IAC1B;IAEA,2FAA2F;IAC3F,IAAI,SAAS,UAAU,CAAC,iBAAiB;QACvC,IAAI,QAAQ,MAAM,KAAK,OAAO;YAC5B,QAAQ,GAAG,CAAC,6CAA6C;YACzD,OAAO,4LAAY,CAAC,IAAI;QAC1B;IACA,kEAAkE;IACpE;IAEA,MAAM,cAAc,QAAQ,OAAO,CAAC,GAAG,CAAC;IACxC,QAAQ,GAAG,CAAC,mBAAmB;IAE/B,MAAM,QAAQ,aAAa;IAC3B,QAAQ,GAAG,CAAC,qBAAqB;IAEjC,IAAI,CAAC,OAAO;QACV,QAAQ,GAAG,CAAC;QAEZ,IAAI,SAAS,UAAU,CAAC,UAAU;YAChC,OAAO,4LAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAe,GACxC;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,4LAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,eAAe,QAAQ,GAAG;IACjE;IAEA,MAAM,UAAU,IAAA,wKAAW,EAAC;IAC5B,QAAQ,GAAG,CAAC,mBAAmB;IAE/B,IAAI,CAAC,SAAS;QACZ,QAAQ,GAAG,CAAC;QAEZ,IAAI,SAAS,UAAU,CAAC,UAAU;YAChC,OAAO,4LAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAgB,GACzC;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,4LAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,eAAe,QAAQ,GAAG;IACjE;IAEA,QAAQ,GAAG,CAAC,uBAAuB,QAAQ,KAAK;IAEhD,MAAM,iBAAiB,IAAI,QAAQ,QAAQ,OAAO;IAClD,eAAe,GAAG,CAAC,aAAa,QAAQ,MAAM;IAC9C,eAAe,GAAG,CAAC,gBAAgB,QAAQ,KAAK;IAEhD,OAAO,4LAAY,CAAC,IAAI,CAAC;QACvB,SAAS;YAAE,SAAS;QAAe;IACrC;AACF;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;KAAuD;IACjE,SAAS;AACX"}}]
}